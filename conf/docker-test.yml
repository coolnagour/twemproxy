# Docker testing configuration with multiple Redis instances
# Tests zone-aware routing with Docker containers

global:
    worker_processes: 1
    user: twemproxy
    group: twemproxy

pools:
    # Read pool with zone-aware routing
    redis_read:
        listen: 0.0.0.0:6378
        redis: true
        auto_eject_hosts: true
        timeout: 2000
        server_retry_timeout: 5000
        server_failure_limit: 2
        server_connections: 1
        
        # Zone-aware routing for Docker testing
        zone_aware: true                  # Enable automatic zone detection
        zone_weight: 80                   # 80% preference for same-zone servers
        dns_resolve_interval: 15          # Fast DNS updates for testing
        
        # Connection optimization
        connection_pooling: true
        connection_warming: 1
        dns_failure_threshold: 2
        
        # Multiple Redis instances for testing zone detection
        servers:
            - redis-primary:6379:1
            - redis-replica-1:6379:1  
            - redis-replica-2:6379:1

    # Write pool (primary only)
    redis_write:
        listen: 0.0.0.0:6379
        redis: true
        auto_eject_hosts: true
        timeout: 2000
        server_retry_timeout: 1000
        server_failure_limit: 5
        server_connections: 1
        
        # Zone awareness for writes (single primary)
        zone_aware: true
        connection_pooling: true
        
        servers:
            - redis-primary:6379:1

    # Monitoring pool (distributed across all servers)
    redis_monitor:
        listen: 0.0.0.0:6382
        redis: true
        auto_eject_hosts: false
        timeout: 5000
        server_retry_timeout: 10000
        server_failure_limit: 10
        server_connections: 1
        
        # No zone preference for monitoring (distribute evenly)
        zone_aware: false                 # Disable for even monitoring distribution
        connection_pooling: true
        
        servers:
            - redis-primary:6379:1
            - redis-replica-1:6379:1
            - redis-replica-2:6379:1